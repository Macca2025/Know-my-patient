<nav class="navbar-modern navbar-expand-lg fixed-top" role="navigation" aria-label="Main navigation">
    <div class="container d-flex align-items-center">
        <!-- Brand Logo -->
     {# Patch: Use '/' for brand link on error pages to avoid url_for error #}
     <a class="navbar-brand-modern d-flex align-items-center"
         href="{{ (is_error_page ?? false) ? '/' : url_for('home') }}"
         aria-label="Know My Patient Home">
            <div class="brand-logo-wrapper">
                <img src="/images/logo.png"
                     alt="Know My Patient Logo"
                     class="brand-logo"
                     width="160"
                     height="60">
            </div>
        </a>

        <!-- Mobile Menu Toggle -->
        <button class="navbar-toggler-modern d-lg-none"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#mainNavbar"
                aria-controls="mainNavbar"
                aria-expanded="false"
                aria-label="Toggle navigation menu">
            <span class="toggler-line" aria-hidden="true"></span>
            <span class="toggler-line" aria-hidden="true"></span>
            <span class="toggler-line" aria-hidden="true"></span>
        </button>

        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav-modern ms-auto" role="menubar">
                {% if not session.user_id %}
                    <!-- Guest Navigation -->
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'home' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '/' : url_for('home') }}" role="menuitem">
                            <i class="bi bi-house nav-icon" aria-hidden="true"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'onboarding' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('onboarding') }}" role="menuitem">
                            <i class="bi bi-building nav-icon" aria-hidden="true"></i>
                            <span>Onboarding</span>
                        </a>
                    </li>
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'register' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('register') }}" role="menuitem">
                            <i class="bi bi-person-plus nav-icon" aria-hidden="true"></i>
                            <span>Register</span>
                        </a>
                    </li>
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'login' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('login') }}" role="menuitem">
                            <i class="bi bi-box-arrow-in-right nav-icon" aria-hidden="true"></i>
                            <span>Login</span>
                        </a>
                    </li>
                {% else %}
                    <!-- Authenticated Navigation -->
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'home' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '/' : url_for('home') }}" role="menuitem">
                            <i class="bi bi-house nav-icon" aria-hidden="true"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'dashboard' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('dashboard') }}" role="menuitem">
                            <i class="bi bi-speedometer2 nav-icon" aria-hidden="true"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item-modern" role="none">
                        <a class="nav-link-modern{% if current_route is defined and current_route == 'logout' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('logout') }}" role="menuitem">
                            <i class="bi bi-box-arrow-right nav-icon" aria-hidden="true"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                {% endif %}

                <li class="nav-item-modern" role="none">
                    <a class="nav-link-modern{% if current_route is defined and current_route == 'support' %} active-nav-link{% endif %}" href="{{ (is_error_page ?? false) ? '#' : url_for('support') }}" role="menuitem">
                        <i class="bi bi-question-circle nav-icon" aria-hidden="true"></i>
                        <span>Support</span>
                        </a>
                    </li>
            </ul>
<style>
.active-nav-link {
    background: linear-gradient(90deg, #ede7f6 0%, #e3f2fd 100%);
    color: #5f2dab !important;
    border-radius: 0.75rem;
    font-weight: 600;
}
</style>
                
        </div>
    </div>
</nav>