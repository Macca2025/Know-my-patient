# Log Rotation Configuration for Know My Patient
# Copy this file to /etc/logrotate.d/know-my-patient (requires root/sudo)
# OR use the standalone logrotate command below

# OPTION 1: System-wide log rotation (requires sudo)
# sudo cp logrotate.conf /etc/logrotate.d/know-my-patient
# Test: sudo logrotate -d /etc/logrotate.d/know-my-patient
# Force run: sudo logrotate -f /etc/logrotate.d/know-my-patient

# OPTION 2: Manual rotation using this file
# logrotate -s /Applications/MAMP/htdocs/know_my_patient/var/logrotate.state logrotate.conf

# Configuration for application logs
/Applications/MAMP/htdocs/know_my_patient/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of backlogs
    rotate 30
    
    # Don't rotate empty logs
    notifempty
    
    # Don't error if log file is missing
    missingok
    
    # Compress old log files (saves disk space)
    compress
    
    # Don't compress yesterday's log (in case still being written to)
    delaycompress
    
    # Create new log file after rotation with these permissions
    create 0644 www-data www-data
    
    # Use date as suffix for old log files
    dateext
    dateformat -%Y%m%d
    
    # Truncate original log file after copying
    copytruncate
    
    # Run these commands after rotation
    postrotate
        # Optional: Send notification or restart service if needed
        # echo "Logs rotated on $(date)" >> /Applications/MAMP/htdocs/know_my_patient/logs/rotation.log
    endscript
}

# Configuration for error logs specifically
/Applications/MAMP/htdocs/know_my_patient/logs/error*.log {
    daily
    rotate 60
    # Keep error logs longer (60 days)
    notifempty
    missingok
    compress
    delaycompress
    create 0644 www-data www-data
    dateext
    copytruncate
}

# Configuration for audit logs (compliance requirement - keep longer)
/Applications/MAMP/htdocs/know_my_patient/logs/audit*.log {
    weekly
    rotate 52
    # Keep audit logs for 1 year (52 weeks) for compliance
    notifempty
    missingok
    compress
    delaycompress
    create 0644 www-data www-data
    dateext
    copytruncate
}
